---
layout: post
title:  "Ubuntu_ 서버를 구축할 때 알아야 할 필수 개념과 명령어_02"
author: fennec-fox
tags: ubuntu
subtitle: "사용자관리와 파일속성, 관리자를 위한 명령어(apt-get, find, 파일묶기 및 압축, CRON과 AT)"
category:  ubuntu

---

<br>

# 1. 사용자와 그룹

### 1. `사용자 관리 파일`

```bash
$ gedit /etc/passwd

```

<br>

```bash
[ /etc/passwd ]

nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:*:0:0:System Administrator:/var/root:/bin/sh
daemon:*:1:1:System Services:/var/root:/usr/bin/false
.....

```

- Root = superuser, 모든 작업에 대한 권한을 가짐

- 내용의 의미

  User_name : password : user_id : group_id : description : home_dir : shell

<br>

### 1-1) Passwd 파일의 password는 왜 * 표시로 되어있는가?

```bash
-rw-r--r--   1 root  wheel    6774  4 10  2018 passwd

```

- 위와 같이 passwd 폴더의 권한은 모든 사용자가 읽을 수 있다. 

  저장될 때 password는 해쉬 값으로 저장이 되지만 처음부터 보이지 않는 것이 좋기에 `*` 로 표시가 되도록 되어있고, password는 /etc/shadow 파일 안에 들어있음

### 1-2) shadow 파일

```bash
root : $6$E2deI.... : 156911 : 0 : 99999 : 7 : : : 

```

- 사용자 계정 : `패스워드를 암호화 시킨 값` : 1970년 1월 1일부터 패스워드가 수정된 날짜의 일수를 계산한 값 : 패스워드가 변경되기 전 최소 사용기간 : 패스워드 변경 전 최대사용기간 : 패스워드사용 만기일 전 경고 메시지를 제공하는 일수 : 로그인 접속차단 일 수: 로그인 사용을 금지하는 일 수 : 예약 필드로 사용되지 않음

- `패스워드를 암호화 시킨 값`  : salt 값으로 암호화 함

  비워져 있는 경우는 패스워드가 필요없다는 뜻

  `*` 는 막아두었다는 뜻

  —> `$` HashID  `$` salt  `$` hash value (`salt는 비밀번호를 길게 만들어주기위해 컴퓨터가 임의로 만들어주는 뒷 비밀번호`)

- 패스워드가 변경되기 전 최소 사용기간 : 0 이면 언제든지 바꿀 수 있다는 의미이다

<br>

### 1-3) passwd 파일의 Shell 영역의 /bin/false는 무슨 파일일까?

- `/bin/false` 파일에 접근 하려고 하면 접근 할 수가 없다. 따라서 다른 user가 접근할 필요가 없을 때에는 shell을 /bin/false로 사용한다.

 <br>

### 1-4) 많이 사용하는 명령어

- `adduser` : 새로운 사용자 추가

- `passwd` : 비번 변경

- `userdel` : 사용자 삭제

  

   

### 2.`그룹`

- Adducer 명령을 실행해서 별도의 그룹을 지정하지 않으면, 자동으로 사용자 이름과 동일한 그룹이 생성되고 새로운 사용자는 생성된 그룹에 자동으로 포함된다.

<br> 

### 2-1) 동일 그룹에 사용자에게 같은 파일 구성 만들기

1. root 사용자의 `/etc/skel` 디렉터리에 `aa.txt` 를 생성한다  
2. `Adduser —gid [그룹ID] [사용자] ` 로 그룹의 사용자 생성
3. 생성된 사용자의 메인화면에 `aa.txt` 가 생성되어 있음을 보게 된다. 

결국, `/etc/skel` 디렉토리로 생성된 사용자의 메인 디렉토리가 만들어짐을 알 수 있다.

<br>

# 2. 파일 소유와 허가권

```bash
-rw-r--r--   1 apple  staff       0  5 28 11:40 sample.txt

```

- 파일유형/파일허가권  , 링크수, 파일소유자 이름, 파일소유그룹 이름, 파일크기, 마지막 변경날짜, 파일이름

<br>

### 1. 파일유형

- `d` : 디렉토리
- `-` : 일반파일
- `b` : 블록 디바이스( ex> HDD, DVD 등의 저장장치)
- `c` : 문자 디바이스 ( ex> 마우스, 키보드 등)
- `l` : 링크 ( ex> 바로가기아이콘 등)

<br>

### 2. 파일 허가권

- 위 파일의 허가권은 4+2 / 4 / 4 ==> 644로 나타낼 수 있다. 

- `디렉터리`는 해당 디렉터리로 이동하려면 `실행 권한이 반드시 있어야`한다.

- 파일 허가권 변경 명령어 : `chmod` 

- 사용법

  1) `chmod[숫자 0 ~ 777]`

  2) `chmod[소유자(u,g,o)]+[권한(w,r,x)]`

  ——> u : 사용자, g: 그룹, o: 그 외 사용자

<br>

### 3. 파일 소유권

- 위 파일의 소유권은 apple 이라는 이름의 사용자가 소유자이며, 그룹은 staff이다. 

- 파일 소유권 변경 명령어 : `chown`

- 사용법 `chown [새로운 사용자이름].[새로운 그룹이름] [파일이름]`

  ——> 그룹이름을 적지 않으면 사용자 이름과 동일하게 그룹이름이 지정됨 

<br>

# 3. umask

파일(666), 디렉토리(777)에서 022만큼 뺀 수

그래서 파일의 권한은 666 - 022 = 644

디렉토리의 권한은 777 - 022 = 755

<br>

root의 umask의 값은 0022

사용자의 umask의 값은 0002 이다.

** umask의 값을 크게해야 권한을 제한해서 주는 것

<br>

# 4. 링크

- inode는 리눅스/유닉스의 파일 시스템에서 사용하는 자료구조를 말하는데, 파일이나 디렉터리의 여러 가지 정보가 있다. `모든 파일이나 디렉터리는 각자 1개씩의 inode가 있으며`, 각 inode에는 `해당 파일의 소유권`, `허가권`, `파일 종류 등의 정보`와 해당 `파일의 실제 데이터가 어디에 있는지 위치`도 있다. 이러한 inode가 모여 있는 공간이 inode 블록이며 일반적으로 전체 디스크 공간의 1% 정도를 차지한다. Data 블록은 실제 데이터가 저장되어 있는 디스크 공간으로 전체 디스크의 대부분을 차지한다.

<br>

​			 원본파일 ————>  inode_1 ————> 원본데이터

- Hard Link는 inode_1을 똑같이 가르키는 파일을 생성시킨다

  <br>

- Soft Link는  inode_2 와 원본파일을 가리키는 포인터, inode_2를 가르키는 파일을 생성시킨다.

  심볼릭링크 ————> indoe_2 ————> 원본파일 포인터

  <br>

### 1) Hard Link

- 생성방법

  `ln [링크대상파일이름] [링크파일이름]`

### 2) Symbolic Link(Soft Link)

- 일반적으로 사용자들이 주로 사용하는 링크

- 생성방법

  `ln -s [링크대상파일이름] [링크파일이름]`

### 3) 생성된 링크확인(inode번호를 제일 앞에 출력)

- `ls -il`

<br>

# 5. 프로그램 설치를 위한 dpkg / apt-get

- ubuntu에서 패키지를 설치하는데 가장 많이 사용되는 명령어가 dpkg와 apt-get 이다. dpkg는 firefox를 사용해 파일을 다운받기 때문에 현재는 apt-get을 더 많이 사용한다.

  <br>

  `dpkg -l [패키지이름]`  명령어는 많이 쓰는데, 패키지가 설치되어있는지 확인용으로 사용된다.

<br>

### 1. `Apt-get` : 의존성이 있는 다른 패키지를 자동으로 먼저 설치해주는 명령어

### 1-1) 설치명령어

- `apt-get -y install [패키지 이름] `  : -y 를 넣어주므로 설치를 계속하시겠습니까? 라는 물음없이 설치를 진행한다.

### 1-2) apt-get의 저장소는 어디인가?

- `/etc/apt/sources.list` 에 저장되어 있어서 인터넷으로 패키지목록을 받아오고 나면 `apt-get update` 명령어로 업데이트 해주어야한다. 

### 1-3) 패키지의 의존성 확인하기

- `apt-cache depends [패키지 이름]` : 패키지에 대한 의존성 정보를 출력함
- `apt-cache rdepends [패키지 이름]` : 패키지에 의존하는 다른 패키지의 목록을 보여줌

### 1-4) 패키지 삭제

- `apt-get remove [패키지 이름]`

  <br>

# 6.파일 압축과 묶기

### 1. 파일 압축

- xz : 압축률이 좋아서 최근에 많이 사용됨
- bzip2  
- gzip : 최근 사용률이 줄었다.
- zip : windows용과 호환되는 확장명

<br>

### 2. 파일 묶기

windows의 파일 압축을 생각해보면, a라는 파일과 b라는 파일을 압축하면 c.zip이 완성된다. 이 때, windows는 a와 b를 c로 묶고 난 후,  c를 압축하는 일을 한다. 

리눅스에서는 '파일 압축'과 '파일 묶기'를 원칙적으로 별개의 프로그램으로 실행하도록 되어있다. 

- tar : 파일을 묶어준다.

<br>

- tar의 옵션기능 

  1) 묶음파일 이름지정(필수)

  - f

  2) 새로운 묶음 만들기

  - c

  3) 묶인 파일을 푼다.

  - x

  4) 묶음과 압축을 한 번에 진행한다.

  - J : tar + xz
  - z : tar + gzip
  - j : tar + bzip2

<br>

`tar` 명령어는 위의 명령어를 조합해서 사용한다.

- 사용법

  `tar cvfJ [파일 이름] [저장경로]` : 묶고 압축하기

  `tar xvfJ [파일 이름].tar.xz ` : 압축 풀기

  `tar xvfj [파일 이름].tar.bz2` : 압축 풀기

<br>

# 7. 파일 위치 검색

### 1. Find [경로] [ 옵션] [조건] [action]

```bash
# home디렉토리에 .swp의 이름을 가진 파일을 찾아서 실행시켜라
# \;은 -exec의 명령어가 끝났음을 나타냄

$ find /home -name "*.swp" -exec { } \; 

```

### 1-1) find 옵션

- -name
- -user : 소유자
- -size : 크기

### 1-2) action 

- -print : default 값
- -exec : 외부명령실행 (외부명령실행 후 \; 로 끝마쳐야 함)

<br>

# 8. CRON 과 AT

- `cron` : 주기적으로 반복되는 일을 자동으로 실행할 수 있도록 시스템 작업을 예약해 놓는 것을 말한다. 

  - Cron과 관련된 서비스(데몬) : crond
  - Cron과 관련된 파일 : /etc/crontab

  ```bash
  # 분  시  일 월 요일  사용자   실행명령 
    00 05  1  *  *   root   cp -r /home  /backup
  
  
  # 매월 1일 오전5시에 'cp -r /home  /backup'을 실행하라는 뜻
  # 요일은 0(일)~6(토)으로 숫자로 표현
  
  ```

  

- `at` : 일회성 작업을 예약한다.

  ```bash
  at 4:00 am tomorrow  # 예약시간 설정
  
  at> apt-get -y upgrade # 예약명령
  at> reboot
  at> ctrl + D   
  at> at -l   # 예약확인
  
  
  # 예약취소
  atrm [작업번호]
  
  ```

  <br>